@page
@model Demo.Pages.MilkTea.IndexModel
@{
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <title>Danh sách trà sữa</title>
    <style>
        .milk-tea-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 60px;
        }

        .milk-tea-item {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }

        .milk-tea-img {
            max-width: 100%;
            height: auto;
        }

        .btn-quantity {
            cursor: pointer;
        }

        .add-to-cart {
            background-color: #28a745;
            color: white;
        }

        .buy-button {
            position: fixed;
            bottom: 70px;
            right: 20px;
        }
    </style>
</head>
<body>
    <h2>Danh sách trà sữa</h2>
    <form method="get">
        <div class="form-group">
            <input type="text" name="searchQuery" class="form-control" placeholder="Tìm kiếm trà sữa" value="@Model.SearchQuery" />
        </div>
        <button type="submit" class="btn btn-primary btn-sm">Tìm kiếm</button>
    </form>
    <br />

    @if (TempData.ContainsKey("Message"))
    {
        <div class='alert alert-success alert-dismissible fade show' role='alert'>
            <strong>@TempData.Peek("Message")</strong>
            <button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>
        </div>
    }

    <div class="milk-tea-grid">
        @foreach (var item in Model.listMilkTeas)
        {
            <div class="milk-tea-item">
                <img src="~/images/@item.img" alt="@item.img" class="milk-tea-img" style="width: 300px; height: 300px;" />
                <h3>@item.name</h3>
                <p>Giá: @item.cost</p>

                <div>
                    <button class="btn-quantity btn btn-danger btn-sm" data-action="decrease">-</button>
                    <input type="number" min="1" value="1" style="text-align: center;" readonly />
                    <button class="btn-quantity btn btn-primary btn-sm" data-action="increase">+</button>
                </div>
                <form method="post" >
                    <input type="hidden" name="itemImage" value="@item.img" />
                    <input type="hidden" name="itemName" value="@item.name" />
                    <input type="hidden" name="itemCost" value="@item.cost" />
                    <input type="hidden" name="itemQuantity" value="1" />
                    <button class="btn btn-success btn-sm add-to-cart"
                                    data-item-id="@item.id"
                                    data-item-name="@item.name"
                                    data-item-cost="@item.cost">
                        Thêm vào giỏ hàng
                    </button>
                </form>
            </div>
        }
    </div>

    <div class="buy-button">
        <a class="btn btn-success btn-lg" href="/Cart/Index">Giỏ hàng</a>
    </div>


    <script>
        const quantityButtons = document.querySelectorAll('.btn-quantity');
        const addToCartButtons = document.querySelectorAll('.add-to-cart');

        quantityButtons.forEach(button => {
            button.addEventListener('click', function () {
                const action = button.getAttribute('data-action');
                const quantityInput = button.parentElement.querySelector('input[type="number"]');
                let quantity = parseInt(quantityInput.value);

                if (action === 'increase') {
                    quantity++;
                } else if (action === 'decrease' && quantity > 1) {
                    quantity--;
                }

                quantityInput.value = quantity;
                const itemQuantityField = button.parentElement.parentElement.querySelector('input[name="itemQuantity"]');
                itemQuantityField.value = quantity;
            });
        });

        setTimeout(function () {
            $(".alert").alert('close');
        }, 3000);
    </script>
</body>
</html>
